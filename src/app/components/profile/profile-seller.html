<div layout>
    <div flex="30" hide-sm></div>
    <md-card layout="column" flex>
        <form name="profileForm" layout="column">
            <div layout layout-align="center center" layout-padding>
                <div flex="8" ng-click="goBack()" class="back"></div>
                <h4 flex class="profile-header">PERSONAL INFORMATION</h4>

                <div layout layout-align="center center" flex-sm="20" ui-sref="profilestore" class="btn sml">
                    <ng-md-icon icon="local_mall" style="fill: white"></ng-md-icon>
                </div>
            </div>
            <div ng-if="treeConfig" class="profile-tree" ui-tree data-drag-enabled="false">
                <md-divider></md-divider>
                <ol ui-tree-nodes="" ng-model="treeConfig">
                    <li ng-repeat="unit in treeConfig" ui-tree-node collapsed="true">
                        <div layout layout-padding ui-tree-handle ng-click="canToggle(unit.code)?toggle(this):''"
                             class="top-transaction">
                            <div flex="10" layout layout-align="center center">
                                <ng-md-icon icon="{{unit.icon}}" style="fill: lightcoral" size="24"></ng-md-icon>
                            </div>
                            <!---->
                            <div layout layout-align="start center" flex>
                                <div ng-if="unit.name === 'Phone number'" class="main-title">
                                    <span>{{profile.phone?(profile.phone|tel):'Verify phone number'}}</span>
                                </div>
                                <div ng-if="unit.name === 'Your card'" class="main-title">
                                    {{profile.card_token_created_at?'Card verified ' + (profile.card_token_created_at |
                                    amCalendar):'Enter debit card requisites'}}
                                </div>
                                <div ng-if="unit.name === 'Postal address'" class="main-title">{{profile.address}},
                                    {{profile.apartment ? profile.apartment + ', ' : ''}} {{profile.city}},
                                    {{profile.state}},
                                    {{profile.zipcode}}
                                </div>
                                <div ng-if="unit.name === 'Name'" class="main-title">
                                    {{profile.fullName}}
                                </div>
                                <!---->
                            </div>
                            <div ng-if="canToggle(unit.code)" layout="column" layout-align="center center" flex="10">
                                <ng-md-icon layout layout-fill ng-if="unit.name !== 'Phone number'"
                                            icon="{{collapsed?'expand_more':'expand_less'}}"
                                            style="fill: lightcoral"
                                            size="24">
                                </ng-md-icon>
                                <ng-md-icon ng-if="unit.name === 'Phone number' && !profile.phone_validated_at"
                                            icon="expand_more" style="fill: lightcoral"
                                            size="24">
                                </ng-md-icon>
                            </div>
                        </div>
                        <md-divider></md-divider>
                        <ol ui-tree-nodes="" ng-model="unit.subs" ng-class="{hidden: collapsed}">
                            <li ng-repeat="sub in unit.subs" ui-tree-node data-collapsed="true" ng-if="!collapsed"
                                class="am-collapse">
                                <div ui-tree-handle>
                                    <div ng-if="unit.name === 'Phone number'" layout="column" layout-padding>
                                        <!--<div layout layout-padding><span class="md-caption">We will send you SMS with verification code</span></div>-->
                                        <div layout ng-if="!profile.phone_validated_at">
                                            <md-input-container flex>
                                                <label>Mobile number</label>
                                                <input ng-model="profile.phone" type="text">
                                            </md-input-container>
                                            <div layout layout-align="center center"
                                                 ng-if="profile.phone.length>7 && !profile.phone_validated_at"
                                                 class="am-fade-and-scale">
                                                <md-button class="md-accent md-raised md-hue-1"
                                                           style="background-color: lightcoral; color:white;"
                                                           ng-click="textToVerify()">Send Code
                                                </md-button>
                                            </div>
                                        </div>
                                        <div layout ng-if="profile.phone.length>7 && !profile.phone_validated_at">
                                            <md-input-container flex>
                                                <label>Enter texted code</label>
                                                <input ng-model="verifyPhoneCode" type="text">
                                            </md-input-container>
                                            <div layout layout-align="center center"
                                                 ng-if="verifyPhoneCode.length>5 && !profile.phone_validated_at"
                                                 class="am-fade-and-scale">
                                                <md-button class="md-accent md-raised md-hue-1 io-primary-btn"
                                                           ng-click="sendCode(verifyPhoneCode)">Confirm Code
                                                </md-button>
                                            </div>
                                        </div>
                                        <h4 ng-if="profile.phone_validated_at">Number is verified!</h4>
                                    </div>
                                    <div layout ng-if="unit.name === 'Your card'">
                                        <div layout layout-fill layout-padding
                                             ng-if="profile.card_token_created_at">
                                            <svg class="svg-debit" viewBox="0 0 32 23">
                                                <path fill="#e5e5e5" class="svg-debit-card"
                                                      d="M1.993 0h28c1.104 0 2 .895 2 2v18.999c0 1.104-.896 2.001-2 2.001h-28c-1.104 0-2-.896-2-2.001v-18.999c0-1.105.895-2 2-2z"></path>
                                                <path fill="#bbb" class="svg-debit-data"
                                                      d="M12.993 15v2h16v-2h-16zm0 5h10v-2h-10v2zm-4-5h-4c-1.104 0-2 .896-2 2v1c0 1.104.896 2 2 2h4c1.104 0 2-.896 2-2v-1c0-1.104-.896-2-2-2z"></path>
                                                <path fill="#fff" class="svg-debit-sign"
                                                      d="M2.993 9h26v3h-26v-3z"></path>
                                                <path fill="#555" class="svg-debit-read"
                                                      d="M-.007 3h32v3h-32v-3z"></path>
                                                <text x="5" y="11.6" fill="black" style="font-size: 2.8px;">****
                                                    ****
                                                    ****
                                                    4589
                                                </text>
                                            </svg>
                                        </div>
                                        <div ng-if="!profile.card_token_created_at" layout="column" layout-fill
                                             layout-wrap>
                                            <ng-form name="verifyCardForm" novalidate=""
                                                     layout-wrap>
                                                <div layout layout-sm="column" layout-fill>
                                                    <md-input-container flex-sm flex-gt-sm="80">
                                                        <label>Card number</label>
                                                        <input ng-model="cardNumber" type="text"
                                                               card-number-validator=""
                                                               x-autocompletetype="cc-number" restrict-numeric=""
                                                               card-number-formatter="" name="ccNumber"
                                                               ng-model="cardNumber"
                                                               card-type="cardType" required>
                                                    </md-input-container>
                                                    <md-input-container flex-sm flex-gt-sm="20">
                                                        <label>00/00</label>
                                                        <input type="text"
                                                               x-autocompletetype="cc-exp"
                                                               maxlength="9"
                                                               restrict-numeric=""
                                                               card-expiry-validator=""
                                                               card-expiry-formatter="" name="ccExpiry"
                                                               ng-model="cardExpiry" required>
                                                    </md-input-container>
                                                </div>
                                                <div layout layout-sm="column" layout-fill>
                                                    <md-input-container flex-sm flex-gt-sm="50">
                                                        <label>CVV</label>
                                                        <input type="text" x-autocompletetype="cc-csc"
                                                               restrict-numeric=""
                                                               card-cvc-validator=""
                                                               card-cvc-formatter="" ng-maxlength="4"
                                                               ng-pattern="/\d*/"
                                                               name="ccCvc" ng-model="cardCvc" required>
                                                    </md-input-container>
                                                    <div ng-if="(verifyCardForm.$dirty && verifyCardForm.$valid)"
                                                         flex-sm flex-gt-sm="50"
                                                         layout="column" layout-align="center center">
                                                        <div layout layout-align="center center" layout-padding
                                                             layout-fill type="submit"
                                                             ng-click="verifyCard(cardNumber, cardExpiry, cardCvc)"
                                                             class="btn btn-buy btn-post">Verify Card
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-form>
                                        </div>
                                    </div>
                                    <div ng-if="unit.name === 'Postal address'" layout="column" layout-padding
                                         layout-fill>
                                        <div layout layout-sm="column">
                                            <md-input-container flex-sm flex-gt-sm="70">
                                                <label>Address</label>
                                                <input ng-model="profile.address" type="text">
                                            </md-input-container>
                                            <md-input-container flex-sm flex-gt-sm="30">
                                                <label>Apartment</label>
                                                <input ng-model="profile.apartment" type="text">
                                            </md-input-container>
                                        </div>
                                        <div layout layout-sm="column">
                                            <md-input-container flex-sm flex-gt-sm="70">
                                                <label>City</label>
                                                <input ng-model="profile.city" type="text">
                                            </md-input-container>
                                            <md-input-container flex flex-gt-sm="30">
                                                <label>State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                                <input ng-model="profile.state" type="text">
                                            </md-input-container>
                                        </div>
                                        <div layout layout-sm="column">
                                            <md-input-container flex>
                                                <label>Zipcode</label>
                                                <input ng-model="profile.zipcode" type="text">
                                            </md-input-container>
                                            <div layout layout-padding>
                                                <div flex class="btn" flex ng-click="verifyAddress()">
                                                    Verify
                                                </div>
                                                <div ng-if="profileForm.$dirty" flex="5"></div>
                                                <div ng-if="profileForm.$dirty" flex class="btn" ng-click="save()">
                                                    {{profileForm.$dirty?'Save':'Done'}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <md-divider></md-divider>
                                </div>
                            </li>
                        </ol>
                    </li>
                </ol>
            </div>
        </form>
    </md-card>
    <div flex="30" hide-sm></div>
</div>